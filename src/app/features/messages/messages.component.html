<mat-sidenav-container class="h-screen bg-gray-900 text-white">
  <!-- Left Sidebar: Contacts -->
  <mat-sidenav mode="side" opened class="w-64 bg-gray-800">
    <mat-toolbar class="bg-gray-800">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Search Contacts</mat-label>
        <input matInput placeholder="Search Contacts">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </mat-toolbar>
    <mat-list>
      <mat-list-item *ngFor="let contact of contacts" (click)="selectContact(contact)">
        <img matListItemAvatar [src]="contact.avatar || 'default.png'" alt="{{contact.firstName + ' ' + contact.lastName}}">
        <span matListItemTitle>{{contact.firstName + ' ' + contact.lastName}}</span>
        <span matListItemLine *ngIf="contact.email">{{contact.email}}</span>
      </mat-list-item>
    </mat-list>
  </mat-sidenav>

  <!-- Right Chat Window -->
  <mat-sidenav-content class="flex flex-col">
    <!-- Chat Header -->
    <mat-toolbar class="bg-gray-800" *ngIf="selectedContact">
      <img class="w-10 h-10 rounded-full mr-2" [src]="selectedAvatar || 'default.png'" alt="{{selectedContact}}">
      <span>{{selectedContact}}</span>
      <span class="flex-1"></span>
      <mat-icon>more_vert</mat-icon>
    </mat-toolbar>

    <!-- Messages List -->
    <div class="flex-1 overflow-y-auto p-4 bg-gray-900">
      <div *ngFor="let msg of messages" class="mb-4 flex" [ngClass]="{'justify-end': msg.senderId === currentUserId}">
        <div class="flex" [ngClass]="{'flex-row-reverse': msg.senderId === currentUserId}">
          <img *ngIf="msg.senderId !== currentUserId" class="w-8 h-8 rounded-full mr-2" [src]="getAvatarForMessage(msg.senderId)" alt="{{msg.senderId}}">
          <div class="chat-bubble" [ngClass]="{'sent': msg.senderId === currentUserId, 'received': msg.senderId !== currentUserId}">
            <p class="m-0">{{msg.content}}</p>
            <span class="text-xs text-gray-400">{{msg.timestamp | date:'short'}}</span>
            <span *ngIf="msg.readBy?.length === 2" class="text-xs text-green-400">✓✓</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Send Input -->
    <div class="p-4 bg-gray-800 flex" *ngIf="selectedChannelId">
      <mat-form-field appearance="outline" class="flex-1 mr-2">
        <input matInput [(ngModel)]="newMessage" placeholder="Send message" (keyup.enter)="sendMessage()">
      </mat-form-field>
      <input type="file" (change)="onFileChange($event)" class="mr-2">
      <button mat-raised-button color="primary" (click)="sendMessage()">Send</button>
      <button mat-raised-button color="accent" (click)="sendWithFile()" *ngIf="file">Send File</button>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>